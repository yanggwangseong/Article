---
title: S3 비용 성능 최적화
permalink: /posts/aws-s3-performance
---
- 503(Slow Down) 상태를 cloud watch를 통해서 모니터링 해야합니다.

- signed-url을 발급 받을때 key를 지정 해주기 때문에 S3에 루트 권한을 가지는 IAM 사용자로 url을 만들어서 클라이언트에게 전달 해주더라도 이미 prefix가 `profile/image/` 로 최적화 접근을 하는군.
- key가 명확히 지정된 경우에는 성능 차이가 없습니다.

* *prefix는 중요하고 그거에 따라서 IAM 사용자를 나눠도 되고 안나눠도 되는데 이건 보안적인 문제*
* 업로드시
	* 하나의 prefix로 시작하는 곳에 적당한 개수의 파일들을 업로드 되게 관리를 하게 되었을 때 지역성 이론에 따라서 특히나 `yyyy-mm-dd` 방식이 중요한게 해당 날짜에 사용자들이 파일을 업로드 할 때 지역성 이론을 따를 수 있는거군요. 그래서 게시글을 기준으로 봤을때 `articles/thumnail/2025-01-15` 이렇게 prefix를 설계해 둔다면 2025-01-15일에 사용자들이 글을 작성 할 때 `2025-01-15` 객체에 접근이 잦기 때문에 지역성 이론을 통해서 페이징 기법에서 자주 사용하는 페이지로 인식 되는거군요!
	* 조회시
		* 보통 사용자들이 글을 올리면 날짜별로 정렬이 되니까 `articles/thumnail/2025-01-15` 의 글들이 거의 자주 지속적으로 조회될 가능성이 높으니까 이것 또한 지역성 이론으로 인해서 그만큼 페이징 기법에서 자주 사용 하는 페이지로 인식되는거군요.
		* *CloudFront와 CDN도 캐시 기반으로 동작하기 떄문에*  캐시 자체도 애초에 지역성 이론을 기반으로 하기 때문에 캐시 성능도 역시나 이러한 `prefix` 설계 최적화를 통해서 더 높은 효율성을 가질 수 있게 된다.
* *prefix* 설계는 생각보다 매우매우 중요한것 같다. 애플리케이션에따라 그리고 사용하는 기능에 따라 다르게 설계 해야 좀 더 지역성 이론을 잘 활용하여서 페이지 폴트율을 줄여 시스템 성능을 최적화 할 수 있는것이다.

# 흠 비용 최적화라고 하기 애매하군

## 이부분들은 좀 잘못된것 같군

- S3 버킷 이용 시 성능 최적화를 위한 `prefix` 적극 활용에 대해
	- aws, 당근, 인프런, 원티드 예시
	- 적절한 경로에 적절한 prefix를 생성 하는것이 굉장히 중요 합니다.
	- prifix의 중요성은 객체를 업로드 하고 검색 할때 성능을 최적화 할 수 있습니다.
	- 성능 최적화는 곧 *비용 최적화* 로까지 이어지는데 이는 S3는 각 GET, PUT, LIST 요청에 대해 별도의 비용이 부과 되고 S3에서 데이터를 읽거나 쓰는 트래픽 요금이 발생하기 때문입니다.
		- 특히나 전체 접근 가능한 IAM 사용자로 `LIST` 요청은 추가 비용을 발생 시킵니다.
		- S3에서 데이터를 읽거나 쓰는 트래픽 요금이 발생합니다.
	- 전체적인 그림 설명 적절한 크기의 버킷 prefix를 예시로 3개정도 만들고 각각에 IAM 사용자를 연결 하고 , 각각의 prefix에다가 스토리지 정책(Lifecycle Rule) 적용 예시.
	- 업로드시에 특정 prefix까지의 권한을 가진 IAM 사용자로 분리하여 `Pre-signed URL` 을 제공 해야 합니다.
	- 그걸 통해서

- GET 요청 최적화의 대중적인 방법중 하나인 cloud-front와 CDN을 사용
- 조회시에는 일반적으로 클라우드 프론트를 통한 CDN으로 캐싱을 통해서 비용을 감소 할 수 있지만 온디맨드 방식의 이미지 리사이징 기능으로 람다에서 캐시 미스가 발생 했을때 최초로 가져오는 작업이 필요한데 이때 제한된 prefix의 해당 버킷의 prifix의 접근 권한을 가진 IAM 사용자를 제공 한다면 굉장히 빠른 접근 속도를 통한 성능 최적화를 제공 할 수 있습니다.


- 결론 요약