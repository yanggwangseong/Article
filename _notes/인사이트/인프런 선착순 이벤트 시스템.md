---
title: 인프런-선착순-이벤트-시스템
permalink: /인사이트/인프런-선착순-이벤트-시스템
tags:
layout: page
image: /assets/oop-01.png
---

## 인프런 선착순 이벤트 시스템

---

### 📚 Contents

1. 개요
2. 생각
3. 후기

---

![[Pasted image 20250516094850.png]]

해당 선착순 타임 쿠폰 이벤트를 통해서 특정시간대에 해당 쿠폰을 다운 받을 수 있는 기능이 새로 추가 된것 같다.

1. 크롤링은 어떻게 대처 했을까?
2. 동시성 문제를 해결하기 위해서 어떻게 했을까?

## 크롤링은 어떻게 대처 했을까?

- 크롤링을 대처하기 보다 특정 시간대에 이벤트 페이지 url을 제공하는 방법으로 진행하는듯 하다.
- 캡챠 기능을 통해서 봇들을 막을것이라 생각 했는데 생각 해보니까 이런 선착순 쿠폰 이벤트에서 캡챠기능을 사용하면 공평성에 어긋날것 같다.
- 캡챠 기능을 경험한 사용자 입장에서 봤을때 UX가 굉장히 구리다. 분명히 맞게 적었는데 틀리거나 이러면 정가 정시에 들어온 유저 입장에서 다소 억울할 수 있을것 같다.
- 따라서 특정 시간대에 이벤트 URL 페이지를 제공하는 해당 방식은 굉장히 좋은 설계라고 생각한다.

### 내 생각

추가적으로 내 생각에는 여기에서 리다이렉션을 통해서 중간 Layer가 하나 더 있으면 어떨까 싶다.

왜냐하면 이러한 선착순 이벤트가 여러번 되는 경우라면 해당 `endpoint` 가 한번 노출 되고 나면 점점 봇 작업을 할 수 있기 때문이다. 그래서 리다이렉션을 통해서 일종의 추상화 레이어를 하나 두는것이다.

그래서 이벤트 페이지가 새로 만들어지고 추가되고 진행될때 리다이렉션이 어디에서부터 되었는지 **Origin** 검증이 가능해지면서 이를 통해 봇들을 박멸 할 수 있을것 같다.

## 동시성 문제를 해결하기 위해서 어떻게 했을까?

## 선착순 시간대에 서버장애 발생

해당 내용은 개인적인 추측 입니다.

프론트 스택 React, Next.js

(TODO)
인프런 CloudFront로 구성되어 있고 S3로 구성
오토 스케일링 구성은 되어 있을것이라고 생각한다.

프론트 문제라면?

1. Node.js 프로세스 자체 서버가 종료된것 같다.
2. 오토 스케일링 설계를 했으나 해당 추가 인스턴스 조차도 못버틸 만큼 많은 트래픽이 몰렸을 수 있을것 같다.
3. OS Level 문제

Next.js 구성이라면 인프라

앞단 ALB -> Route53 -> ECS로 동작 하는것 같다.

개인적인 생각으로 만약에 프론트 서버 Next.js나 Node.js 장애 문제라면 이런 이벤트 페이지는 S3 버킷 하나에 정적 웹사이트를 배포해서 CloudFront를 통해서 진행 하는게 어떨까 싶다.

왜 이렇게 구성하는게 유리할까?

- Node.js와 무관하게 모든것은 클라이언트 브라우저에게 위임 할 수 있다.
  - 백엔드 트래픽만 신경 쓰면 된다.

백엔드 문제라면?

위와 똑같이 해당 문제에 대해서 고려해야 한다.

1. Node.js 프로세스 자체 서버가 종료된것 같다.
2. 오토 스케일링 설계를 했으나 해당 추가 인스턴스 조차도 못버틸 만큼 많은 트래픽이 몰렸을 수 있을것 같다.
3. OS Level 문제

CASE1: Node.js 프로세스 자체가 죽은 상황에서는 이를 위한 페일오버 전략을 구성 해야될것 같다.
CASE2: 이런 경우는 이미 HardLimit을 설정 해두었기 때문에 피할 수 없는 장애이고 하지만 이로 인해서 어느정도 트래픽이 들어오는지 데이터를 얻었기 때문에 해당 피크 타임에 오토스케일링 그룹을 얼마나 설계 해야될지 알게 되었으니 충분히 가치 있는 투자인것 같다.

그러나 CASE2인경우는 잘 발생하지 않을것 같다. 오토스케일링 그룹의 HardLimit을 널널하게 해두더라도 스케일아웃 되지 않으면 금액이 발생하지 않는다.

CASE3: OS Level 문제
EC2 인스턴스 (얘가 static resource를 가지고 있는 경우)
해당 EC2 인스턴스 Base로 ECS 컨테이너로 운영하는 CASE인 경우가 아마도 CASE2인 경우다.
종종 발생 하는 OS Level의 장애로 인해서 (CPU Bound문제 등) 인스턴스가 죽어버리는 경우인데 보통 인스턴스의 종류가 EC2, Fargate인 경우에서 EC2일때 발생하는 문제이다.

이미 EC2 인스턴스가 죽어버린 경우라면 다시 재시작 해야하는데 여기서 최악으로 OS자체가 죽어버린 경우라면 재시작도 안되고 강제 종료까지 안되는 경우에는 AWS에 문의해야 하는 상황이 발생할 수 도 있다.

나라면 어떻게 했을까?

1. EC2 인스턴스를 Burstable 인스턴스를 하나 생성 해서 선착순 쿠폰 관련된 module만 분리하여 ECS 서비스로 띄웠을것 같다.
2. EC2가 아닌 Fargate를 사용한다.

---

## Reference
