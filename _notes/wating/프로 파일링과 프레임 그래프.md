---
title: 프로 파일링과 프레임 그래프
permalink: /wating/2
---

# 알아볼것들
- k6와 클리닉js의 연동 가능성과 시각화가 용이한가?
- k6 결과와 플레임 그래프 어떻게 이전 자료를 관리해야 할까?
- 프로젝트 v1과 v2를 비교하기 위해서 어떻게 나눠두면 좋을까?

2.2 K6 결과와 InfluxDB/Grafana 통합  
K6가 제공하는 데이터를 InfluxDB에 저장하면, Grafana를 통해 성능 결과를 동적으로 시각화할 수 있습니다.  
  
실무 활용  
K6의 결과를 매 테스트마다 기록해두고, Grafana에서 버전별 결과를 비교.  
Markdown 문서에 데이터 스냅샷(이미지)와 함께 Grafana 대시보드 링크를 포함.  
2.3 Flame Graph 저장 및 공유  
플레임 그래프는 성능 병목을 시각화하는 데 필수적인 도구입니다. 이를 활용하기 위해:  
  
방법  
플레임 그래프 생성:  
성능 테스트 중 perf나 0x 같은 프로파일링 도구를 사용하여 플레임 그래프 생성.  
SVG/HTML 파일로 저장:  
플레임 그래프를 SVG나 HTML 형식으로 저장하여 공유.  
Markdown에 링크 포함:  
결과 문서에 그래프 파일을 링크로 첨부하거나, SVG 파일을 인라인으로 표시.  
  
플레임 그래프를 html이나 svg로 공유 할 수 있는건 굉장히 문서화 하기 좋을것 같은데  
K6 결과와 InfluxDB/Grafana 통합은 이게 사실 그라파나 대시보드가 띄워져 있는 사이트를 공유 해야 하기 떄문에 썩 마크다운 문서화에 좋아 보이진 않는데 html이나 먼가 svg 같은걸로 이것도 하는 방법 없나요?  
현재 docker-compose 환경에서 그라파나와 k6 influxDB를 연동해둔 상태입니다.


## **1. K6 + InfluxDB + Grafana의 시각화 결과 내보내기**

### **1.1 Grafana 대시보드를 이미지나 PDF로 내보내기**

Grafana는 각 패널 또는 전체 대시보드를 이미지나 PDF로 내보내는 기능을 제공합니다.

#### **방법: 패널 이미지를 내보내기**

1. Grafana 대시보드에서 시각화된 패널을 선택.
2. 패널의 **공유(Share)** 버튼 클릭.
3. **Direct link rendered image** 옵션 선택.
    - 해당 링크를 사용하여 이미지를 다운로드.
4. 이미지를 Markdown 문서에 포함:
    
    markdown
    
    코드 복사
    
    `![K6 Performance](./images/k6-performance-panel.png)`
    

#### **방법: 전체 대시보드를 PDF로 내보내기**

1. Grafana 상단 메뉴에서 **Share Dashboard** 클릭.
2. PDF 내보내기 옵션 선택.
3. PDF 파일을 저장하고, Markdown 문서에 링크로 첨부:
    
    markdown
    
    코드 복사
    
    `[Grafana Dashboard PDF](./docs/k6-performance-dashboard.pdf)`




### **.1 K6 + InfluxDB + Grafana**

- **목적**:
    - InfluxDB에 K6의 성능 테스트 데이터를 저장하고, Grafana에서 InfluxDB를 데이터 소스로 연결하여 시각화.
- **동작 방식**:
    - K6는 `K6_OUT` 환경 변수를 통해 데이터를 InfluxDB로 보냄.
    - Grafana는 InfluxDB에서 데이터를 가져와 대시보드로 시각화.

### **1.2 K6 + Prometheus + Grafana**

- **목적**:
    - Prometheus에 K6의 메트릭 데이터를 푸시하고, Grafana에서 Prometheus를 데이터 소스로 연결하여 시각화.
- **동작 방식**:
    - K6는 Prometheus로 데이터를 직접 푸시하지 않으며, Prometheus **Pushgateway**를 통해 데이터를 전달.
    - Prometheus는 푸시된 데이터를 스크랩(Scrape)하여 저장.
    - Grafana는 Prometheus에서 데이터를 가져와 대시보드로 시각화.

## **3. 두 조합을 동시에 사용할 수 있는지?**

### **동시에 사용 가능**

K6는 다양한 출력 옵션을 지원하므로, 동일한 테스트에서 **InfluxDB**와 **Prometheus**에 데이터를 동시에 전송할 수 있습니다.

#### **K6 환경 변수로 여러 출력 설정**

yaml

코드 복사

`environment:   - K6_OUT=influxdb=http://influxdb:8086/k6, prometheus-pushgateway=http://pushgateway:9091`

#### **동작 흐름**

1. K6는 데이터를 InfluxDB와 Prometheus Pushgateway에 동시에 전송.
2. Grafana는 각각 InfluxDB와 Prometheus를 데이터 소스로 설정하여 시각화.

- 성능 테스트와 시스템 모니터링을 통합하려면 **K6 + InfluxDB + Prometheus + Grafana**를 조합.
- Prometheus는 **테스트 중 실시간 경고**에, InfluxDB는 **장기적 데이터 저장**에 사용.


# 결론
- InfluxDB는 결국 디비 라고 생각하면 된다.
- 그라파나는 추가적인 메트릭스를 추가할 수 있게 해주어서 더욱 디테일하게 모니터링 할 수 있게 도와준다.


## **1. Clinic.js와 K6 조합이 가능한 이유**

1. **Clinic.js**는 애플리케이션 내부에서 발생하는 성능 병목(CPU, 메모리, 이벤트 루프 등)을 분석.
2. **K6**는 외부에서 부하를 가하며 서버의 응답 성능(RPS, 응답 시간 등)을 테스트.
3. 두 도구를 함께 사용하면:
    - K6로 서버에 부하를 가하면서 동시에 Clinic.js로 내부 병목을 분석 가능.
    - 결과적으로 **외부 지표(K6)**와 **내부 지표(Clinic.js)**를 함께 비교하여, 문제의 원인을 더 잘 이해할 수 있음.

