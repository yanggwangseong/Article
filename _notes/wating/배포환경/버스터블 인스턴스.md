---
title: mokakbab-issue
permalink: /wating/k6-spike-test
---

### **실제 CPU 사용 상황을 모니터링하는 방법**

1. **Amazon CloudWatch 사용**
    
    - **CloudWatch 메트릭**에서 CPUUtilization을 모니터링하세요.
        - CPUUtilization(%)는 사용 가능한 vCPU에 대한 사용률을 나타냅니다.
        - 예를 들어, 1 vCPU를 100% 사용할 경우 CPUUtilization은 100%로 나타납니다.
    - CPU Credit Balance를 확인하여 크레딧 소진 여부를 파악하세요.
        - **CPUCreditBalance**: 남은 CPU 크레딧을 나타냅니다.
        - 크레딧이 소진되면 성능이 제한될 수 있습니다.
2. **Linux 명령어로 모니터링**
    
    - **`htop`** 또는 **`top`** 명령어를 사용하여 CPU 코어별 부하를 확인합니다.
        - vCPU가 1개인 경우, 단일 코어에서 모든 부하가 처리됩니다.
    - **`mpstat`**:
        - CPU 사용량을 상세히 분석합니다.
        - 명령어: `mpstat -P ALL 1`
    - **`sar`**:
        - 시스템 전체의 CPU 사용량을 확인합니다.
        - 명령어: `sar -u 1`
3. **Linux 커널의 CPU 스케줄링 확인**
    
    - **`lscpu`** 명령어:
        - 물리적 코어와 논리적 코어(vCPU) 수를 확인할 수 있습니다.
        - 명령어: `lscpu`
    - CPU가 과부하 시 스케줄러의 동작을 추적하려면 **`dmesg`**를 확인하세요:
        - 명령어: `dmesg | grep -i cpu`
4. **Network 및 I/O 부하 확인**
    
    - 트래픽 증가로 인해 CPU가 처리하는 작업량이 증가할 수 있으므로 네트워크 및 I/O 사용량도 모니터링하세요:
        - **`iotop`**: I/O 작업에 대한 모니터링.
        - **`iftop`**: 네트워크 사용량 모니터링.

### **버스터블 인스턴스 특이점 모니터링**

버스터블 인스턴스의 성능은 **CPU 크레딧**에 의존하므로 다음 메트릭을 추가로 확인해야 합니다:

1. **CPU Credit Usage**:
    - 사용된 CPU 크레딧의 양.
    - 크레딧 사용량이 급증할 경우, 크레딧이 고갈될 가능성이 있음.
2. **CPU Credit Balance**:
    - 남은 CPU 크레딧의 양.
    - 크레딧이 부족하면 성능이 저하될 수 있음.

```bash
aws cloudwatch get-metric-statistics --namespace AWS/EC2 \
    --metric-name CPUCreditBalance \
    --dimensions Name=InstanceId,Value=INSTANCE_ID \
    --start-time 2025-01-08T23:00:00Z \
    --end-time 2025-01-09T23:00:00Z \
    --period 3600 --statistics Average
```

### **결론**

- **EC2의 버스트 성능은 코어 수 증가가 아니라, 기존 1 vCPU의 부하 처리 능력을 높이는 것**입니다.
- CloudWatch 및 Linux 명령어를 통해 CPU 사용량 및 크레딧 상태를 지속적으로 모니터링하면, 트래픽 증가 시의 동작을 파악할 수 있습니다.
- 특히 **CPU Credit Balance**를 주의 깊게 관찰하세요. 크레딧 소진이 예상되면, 더 높은 스펙의 인스턴스로 업그레이드하는 것을 고려해야 합니다.

```
scp -r ./dist root@211.188.52.168:/home/mokakbab/
L3$u!GFe4ydBb
scp -P 22 root@211.188.52.168:/home/mokakbab/isolate-0x83bf000-5564-v8.log /Users/bugibugi/Project2/flab/Mokakbab/

scp -P 22 root@211.188.52.168:/home/mokakbab/.clinic/12767.clinic-flame.html /Users/bugibugi/Project2/flab/Mokakbab/
```

```sql
query: SELECT 1 AS `row_exists` FROM (SELECT 1 AS dummy_column) `dummy_table` WHERE EXISTS (SELECT 1 FROM `member` `MemberEntity` WHERE ((`MemberEntity`.`email` = ?))) LIMIT 1 -- PARAMETERS: ["qwe123ff44f44@test.com"]
query: START TRANSACTION
query: INSERT INTO `verification_code`(`id`, `code`, `createdAt`, `updatedAt`) VALUES (DEFAULT, ?, DEFAULT, DEFAULT) -- PARAMETERS: ["BB14CD"]
query: COMMIT
query: START TRANSACTION
query: INSERT INTO `member`(`id`, `name`, `nickname`, `password`, `email`, `profileImage`, `refreshTokenId`, `isEmailVerified`, `createdAt`, `updatedAt`, `verificationCodeId`) VALUES (DEFAULT, ?, ?, ?, ?, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, ?) -- PARAMETERS: ["sisi","nunu","$2b$10$ApUGPQFnkF6Rz7tS.xEgLOhwrxWC1lD/S7c4rHabnHvszVlN6ZWpC","qwe123ff44f44@test.com",121061]
query: COMMIT
query: SELECT `member`.`id` AS `member_id`, `member`.`refreshTokenId` AS `member_refreshTokenId` FROM `member` `member` WHERE `member`.`id` = ? -- PARAMETERS: [121036]
query: START TRANSACTION
query: INSERT INTO `refresh_token`(`id`, `token`, `createdAt`, `updatedAt`) VALUES (DEFAULT, ?, DEFAULT, DEFAULT) -- PARAMETERS: ["$2b$10$Z3aRlyPfxEslWEM798BYSeWV56PHGZaI/OmLWJ1beBIjywowfKdJe"]
query: COMMIT
query: UPDATE `member` SET `refreshTokenId` = ?, `updatedAt` = CURRENT_TIMESTAMP WHERE `id` = ? -- PARAMETERS: [120556,121036]
```

```
Error: Host '211.188.52.168' is blocked because of many connection errors; unblock with 'mysqladmin flush-hosts'
```

