---
title: ë¹„ê´€ì  ë½ ë‚™ê´€ì  ë½
permalink: /study/1
tags: 
layout: page
image: /assets/cat01.png
---

## ë¹„ê´€ì  ë½ ë‚™ê´€ì  ë½

- ğŸ™ **[ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸(GitHub)](https://github.com/yanggwangseong/daily-sentence-be)** 
- ğŸ”— **[PR #14 ì´ìŠˆ ë§í¬](https://github.com/f-lab-edu/Mokakbab/pull/82)** 

---

### ğŸ“š Contents

1. ê°œìš”
2. ë¬¸ì œ
3. ë¬¸ì œ í•´ê²° ë° ê²°ê³¼

---

**ë‚™ê´€ì  ë½(Optimistic Lock)**Â ì€ ë°ì´í„° ì¶©ëŒì´ ì ì„ ê²ƒìœ¼ë¡œ ê°€ì •í•˜ê³ , ë°ì´í„°ë¥¼ ì½ì„ ë•Œ ë½ì„ ì„¤ì •í•˜ì§€ ì•Šê³  íŠ¸ëœì­ì…˜ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œ ì¶©ëŒì´ ë°œìƒí•˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ë³´í†µ versionê³¼ ê°™ì€ ë³„ë„ì˜ êµ¬ë¶„ ì»¬ëŸ¼ì„ ì‚¬ìš©í•´ì„œ ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë©°, ì¶©ëŒì´ ë°œìƒí•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì§ì ‘ ë¡¤ë°±í•˜ê±°ë‚˜ ì¬ì‹œë„ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•©ë‹ˆë‹¤.

**ë¹„ê´€ì  ë½(Pessimistic Lock)**Â ì€ ë°ì´í„° ì¶©ëŒì´ ë§ì„ ê²ƒìœ¼ë¡œ ê°€ì •í•˜ê³ , íŠ¸ëœì­ì…˜ì´ ì‹œì‘ë  ë•Œ ê³µìœ ë½(Shared Lock, S-Lock) ë˜ëŠ” ë² íƒ€ë½(Exclusive Lock, X-Lock)ì„ ì„¤ì •í•˜ì—¬ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ë°ì´í„°ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

**'READ UNCOMMITTED', 'READ COMMITTED', 'REPEATABLE READ', 'SERIALIZABLE'** 

https://amenable.tistory.com/144 

- í˜„ìƒ - DIRTY READ, NON-REPEATABLE READ, PHANTOM READ

1. ACID ì¤‘ Isolation(ê²©ë¦¬ì„±)ì„ ê¹Šì´ ì´í•´í•˜ê³  ìˆë‹¤
2. DB ë™ì‹œì„± ì œì–´ì™€ ê´€ë ¨ëœ ë¬¸ì œë¥¼ ì‹ë³„í•˜ê³ , ì ì ˆí•œ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤
3. RDBì˜ ë‹¤ì¤‘ íŠ¸ëœì­ì…˜ í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ëŒ€í‘œì ì¸ ë¬¸ì œë“¤ì„ ì•Œê³  ìˆë‹¤


## 3. TypeOrmì˜ ë¹„ê´€ì  ë½ ë°©ì‹ë“¤

typeOrmì—ì„œ ë¹„ê´€ì  ë½ì„ ì„¤ì •í• ë ¤ê³  í• ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

**pessimistic_read**Â (ë¹„ê´€ì ì¸ ì½ê¸° ë½)

íŠ¸ëœì­ì…˜ì´ ì½ì€ ë°ì´í„°ë¥¼ í•´ë‹¹ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ëŠ” ê²ƒì„ í—ˆìš©í•˜ë©´ì„œ, ì“°ê¸° ë˜ëŠ” ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

**pessimistic_write**Â (ë¹„ê´€ì ì¸ ì“°ê¸° ë½)

íŠ¸ëœì­ì…˜ì´ ì½ì€ ë°ì´í„°ë¥¼ í•´ë‹¹ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ê¸°, ì“°ê¸°, ìˆ˜ì •í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ë©° ì ‘ê·¼í•˜ì§€ ëª»í•˜ë„ë¡ í•©ë‹ˆë‹¤.

**dirty_read**Â (ë”í‹° ë¦¬ë“œ)

SERIALIZABLE isolation levelì—ì„œ ì‚¬ìš©ë˜ëŠ” Lock ëª¨ë“œë¡œ, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì½ëŠ” ê²ƒì„ í—ˆìš©í•©ë‹ˆë‹¤.  
ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±í•  ê²½ìš°, ì½ì€ ë°ì´í„°ëŠ” ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•Šì•˜ë˜ ê²ƒìœ¼ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

**pessimistic_partial_write**Â (ë¹„ê´€ì ì¸ ë¶€ë¶„ ì“°ê¸° ë½)

ì—”í‹°í‹°ì˜ ì¼ë¶€ë¶„ì— ëŒ€í•œ ì“°ê¸° ì‘ì—…ì—ë§Œ ê°•ë ¥í•œ Lockì„ ì ìš©í•©ë‹ˆë‹¤.  
ë¶€ë¶„ì ì¸ ì“°ê¸° ë½ì„ ì„¤ì •í•˜ì—¬ íŠ¹ì • í•„ë“œë§Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•©ë‹ˆë‹¤.

**pessimistic_write_or_fail**Â (ë¹„ê´€ì ì¸ ì“°ê¸° ë½ ë˜ëŠ” ì‹¤íŒ¨)

ì“°ê¸° ì‘ì—…ì„ ì‹œë„í•˜ê³  ì‹¤íŒ¨í•  ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.  
ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ë°ì´í„°ì— ì“°ê¸° ì‘ì—…ì„ ìˆ˜í–‰ ì¤‘ì´ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.

**for_no_key_update**Â (í‚¤ ì—…ë°ì´íŠ¸ ì—†ìŒ)

ì—”í‹°í‹°ì˜ í‚¤ì— ëŒ€í•œ ì—…ë°ì´íŠ¸ë¥¼ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
í‚¤ í•„ë“œê°€ ë³€ê²½ë˜ë©´ í•´ë‹¹ ì—”í‹°í‹°ì˜ ì €ì¥ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.

**for_key_share**Â (í‚¤ ê³µìœ )

ì½ê¸° ì‘ì—…ì— ëŒ€í•œ Lockì„ ê±¸ì§€ ì•Šê³ , ì—”í‹°í‹°ì˜ í‚¤ë§Œì„ ê³µìœ  Lockìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.  
ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ì½ëŠ” ê²ƒì„ í—ˆìš©í•˜ì§€ë§Œ, í‚¤ì— ëŒ€í•œ ìˆ˜ì •ì„ ë§‰ìŠµë‹ˆë‹¤.


## ì˜ˆì‹œ


- ì¢‹ì•„ìš” ê°œìˆ˜ì˜ ì´ ê°œìˆ˜ë¥¼ ì•„í‹°í´ í•„ë“œì— like_countë¥¼ ì¶”ê°€í•˜ì—¬ ì¡°íšŒì‹œì— ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì„ ì œê±° í•˜ì˜€ìŠµë‹ˆë‹¤.
- articles í…Œì´ë¸”ì— ì¢‹ì•„ìš” ê°œìˆ˜ë¥¼ `select` í•œí›„ì— updateë¥¼ í•˜ê²Œ ë˜ë©´ Lost Update (ê°±ì‹  ë¶„ì‹¤) ë¬¸ì œê°€ ë°œìƒ í•©ë‹ˆë‹¤.
	- articles í…Œì´ë¸”ì— `UPDATE articles SET like_count = like_count + 1 WHERE id = 1;` like_count ìì²´ë¥¼ ì½ì–´ì„œ +1 í•´ì£¼ëŠ” ë°©ë²•.
		- **í–‰ ìˆ˜ì¤€ ì ê¸ˆ(Row-Level Lock)** ë¬¸ì œê°€ ë°œ ìƒí•©ë‹ˆë‹¤.
			- `id = 1` íŠ¹ì • ê²Œì‹œë¬¼ì— í•œí•´ì„œ í–‰ ìˆ˜ì¤€ ì ê¸ˆìœ¼ë¡œ ì¸í•´ì„œ ì¢‹ì•„ìš”ì²˜ëŸ¼ í•´ë‹¹ íŠ¹ì • ê²Œì‹œë¬¼ì— ì—¬ëŸ¬ëª…ì´ ì¢‹ì•„ìš”ë¥¼ í•  ìˆ˜ ìˆëŠ” ìƒí™©ì—ì„œëŠ” ì ê¸ˆ ëŒ€ê¸°ë¡œ ì¸í•´ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒ í•©ë‹ˆë‹¤.
	- ë‚™ê´€ì  ì ê¸ˆì„ í†µí•´ì„œ í•´ê²° í•´ë³´ê¸°. (ì—¬ê¸°ê¹Œì§€ ì ìš©í•˜ê³  ì•„ë˜ëŠ” ì´í›„ì— ê°œì„  í•  ìˆ˜ ìˆëŠ” ì—¬ì§€ë¡œ ë‚¨ê¸°ê¸°)
	- ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ì˜ ì‹¤ì‹œê°„ì„± ë°˜ì˜ì„ ì¤„ì´ê³  ë°°ì¹˜ ì‘ì—…ì„ í†µí•´ì„œ í•´ê²°í•˜ê¸°
		- ê°™ì€ ë°ì´í„°ë¡œ ë™ê¸°í™” í•˜ëŠ”ë°©ë²• ê¶ê·¹ì  ì¼ê´€ì„±(Eventual Consistency)
		- ë°°ì¹˜ ì„œë²„ê°€ í•„ìš”í•˜ë‹¤.

> ì œ ìƒê°ì—ëŠ” ì¢‹ì•„ìš” articles_likeì— ì¢‹ì•„ìš” ë°ì´í„°ë¥¼ ìƒì„± í• ë•Œ ìŠ¤ì¼€ì¼ ì•„ì›ƒí•œ kafka ìƒì‚°ì ì„œë²„ 10ê°œì—ì„œ kafka ë©”ì„¸ì§€ì— ì¢‹ì•„ìš” ìƒì„± ë©”ì„¸ì§€ ë‹´ê³  ìƒì‚°ì ì„œë²„ì—ì„œëŠ” ë¹ ë¥´ê²Œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‘ë‹µ 
> ì†Œë¹„ì ì„œë²„ì—ì„œ articles_like í…Œì´ë¸”ì— ì¢‹ì•„ìš” ë°ì´í„° ìƒì„±. ë ˆë””ìŠ¤ ì„œë²„ì— í•´ë‹¹ ê²Œì‹œë¬¼ì— ì¢‹ì•„ìš” ì¹´ìš´íŠ¸+1ì„ í•˜ê³  ê·¸ë¦¬ê³  ë°°ì¹˜ ì‘ì—…ì„ ìœ„í•œ ì¹´í”„ì¹´ íì— ì‘ì—…ì„ ì €ì¥
> (ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ì¢‹ì•„ìš” í–ˆì„ë–„ RDSì— ì ‘ê·¼ì„ í•œë²ˆë„ ì•ˆí•˜ëŠ”êµ°ìš”)
> ë¬¸ì œì  1. ì¢‹ì•„ìš” í…Œì´ë¸”ì— ë°ì´í„° ìƒì„± ì‹¤íŒ¨ì‹œ?
> - íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‘ì—… ë¬¶ìŒ ì¢‹ì•„ìš” í…Œì´ë¸” ë°ì´í„°ìƒì„±, ë ˆë””ìŠ¤ì— ì¹´ìš´íŠ¸ ì¦ê°€, ë°°ì¹˜ ì‘ì—…ì„ ìœ„í•œ ë©”ì„¸ì§€í ì €ì¥ ì‘ì—…
> ë¬¸ì œì  2. ë°°ì¹˜ ì‘ì—…ì´ ì‹¤íŒ¨ í–ˆì„ ê²½ìš°?
> - íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤íŒ¨ í–ˆì„ë•Œ ë¡¤ë°± í•˜ê³  ì¹´í”„ì¹´ì˜ DLQ(Dead Letter Queue)ë¥¼ í™œìš©í•˜ì—¬ ì²˜ë¦¬ ì‹¤íŒ¨í•œ ë©”ì„¸ì§€ë¥¼ ì €ì¥.

- [ì¢‹ì•„ìš” ê°œìˆ˜ ì¡°íšŒ ìµœì í™”íˆê¸°](https://tecoble.techcourse.co.kr/post/2022-10-10-like-count/) 
- https://sokdak-sokdak.tistory.com/22


---

## Reference

- https://github.com/LandazuriPaul/nest-react
